<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Twitter Clone - A modern social media platform">
    <meta name="theme-color" content="#1da1f2">
    <title>My crush</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/appwrite@10.0.0"></script>
    <style>
        /* Twitter-like CSS */
        :root {
            --twitter-blue: #1da1f2;
            --twitter-blue-hover: #1a91da;
            --twitter-blue-light: rgba(29, 161, 242, 0.1);
            --text-primary: #0f1419;
            --text-secondary: #536471;
            --border-color: #eff3f4;
            --bg-color: #ffffff;
            --bg-secondary: #f7f9fa;
            --hover-color: #f7f7f7;
            --success-color: #00ba7c;
            --error-color: #f91880;
            --retweet-color: #00ba7c;
            --like-color: #f91880;
        }

        [data-theme="dark"] {
            --text-primary: #e7e9ea;
            --text-secondary: #71767b;
            --border-color: #2f3336;
            --bg-color: #000000;
            --bg-secondary: #16181c;
            --hover-color: #181818;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--bg-color);
            color: var(--text-primary);
            line-height: 1.4;
            padding-bottom: 60px;
        }

        /* Header */
        .header {
            position: sticky;
            top: 0;
            background: var(--bg-color);
            padding: 12px 16px;
            border-bottom: 1px solid var(--border-color);
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--twitter-blue);
        }

        /* Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--bg-color);
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: space-around;
            padding: 8px 0;
            z-index: 1000;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px 16px;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.8rem;
            border-radius: 20px;
            transition: all 0.2s ease;
        }

        .nav-item.active {
            color: var(--twitter-blue);
        }

        .nav-icon {
            font-size: 1.3rem;
            margin-bottom: 2px;
        }

        /* Main Content */
        .container {
            max-width: 600px;
            margin: 0 auto;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* Auth Pages */
        .auth-page {
            padding: 40px 20px;
            text-align: center;
        }

        .auth-form {
            max-width: 400px;
            margin: 0 auto;
            padding: 20px;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: var(--text-primary);
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: var(--bg-color);
            color: var(--text-primary);
            font-size: 1rem;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--twitter-blue);
        }

        .auth-toggle {
            margin-top: 20px;
            color: var(--text-secondary);
        }

        .auth-link {
            color: var(--twitter-blue);
            text-decoration: none;
            cursor: pointer;
        }

        /* Tweet Composer */
        .tweet-composer {
            border-bottom: 1px solid var(--border-color);
            padding: 16px;
        }

        .composer-header {
            display: flex;
            gap: 12px;
            margin-bottom: 12px;
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }

        .composer-textarea {
            width: 100%;
            border: none;
            resize: none;
            font-size: 1.2rem;
            background: transparent;
            color: var(--text-primary);
            min-height: 60px;
        }

        .composer-textarea::placeholder {
            color: var(--text-secondary);
        }

        .composer-textarea:focus {
            outline: none;
        }

        .composer-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 12px;
            padding-left: 52px;
        }

        .action-buttons {
            display: flex;
            gap: 12px;
        }

        .action-btn {
            background: none;
            border: none;
            color: var(--twitter-blue);
            font-size: 1.1rem;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: background 0.2s ease;
        }

        .action-btn:hover {
            background: var(--twitter-blue-light);
        }

        .tweet-btn {
            background: var(--twitter-blue);
            color: white;
            border: none;
            padding: 8px 20px;
            border-radius: 20px;
            font-weight: bold;
            cursor: pointer;
            transition: background 0.2s ease;
        }

        .tweet-btn:disabled {
            background: var(--twitter-blue-light);
            cursor: not-allowed;
            opacity: 0.5;
        }

        .tweet-btn:not(:disabled):hover {
            background: var(--twitter-blue-hover);
        }

        .char-count {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-right: 12px;
        }

        .char-count.warning {
            color: #ffad1f;
        }

        .char-count.error {
            color: var(--error-color);
        }

        /* Tweet */
        .tweet {
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
            transition: background 0.2s ease;
            cursor: pointer;
        }

        .tweet:hover {
            background: var(--hover-color);
        }

        .tweet-header {
            display: flex;
            align-items: center;
            gap: 4px;
            margin-bottom: 4px;
        }

        .user-name {
            font-weight: bold;
            color: var(--text-primary);
        }

        .user-handle, .tweet-time {
            color: var(--text-secondary);
        }

        .tweet-content {
            margin-bottom: 12px;
            line-height: 1.4;
        }

        .tweet-actions {
            display: flex;
            justify-content: space-between;
            max-width: 425px;
        }

        .tweet-action {
            display: flex;
            align-items: center;
            gap: 4px;
            background: none;
            border: none;
            color: var(--text-secondary);
            padding: 8px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9rem;
        }

        .tweet-action:hover {
            background: var(--twitter-blue-light);
            color: var(--twitter-blue);
        }

        .comment-action:hover {
            color: var(--twitter-blue);
            background: rgba(29, 161, 242, 0.1);
        }

        .retweet-action:hover {
            color: var(--retweet-color);
            background: rgba(0, 186, 124, 0.1);
        }

        .like-action:hover {
            color: var(--like-color);
            background: rgba(249, 24, 128, 0.1);
        }

        .retweet-action.retweeted {
            color: var(--retweet-color);
        }

        .like-action.liked {
            color: var(--like-color);
        }

        /* Media */
        .tweet-media {
            margin: 12px 0;
            border-radius: 16px;
            overflow: hidden;
        }

        .tweet-media img {
            width: 100%;
            max-height: 400px;
            object-fit: cover;
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.4);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--bg-color);
            border-radius: 16px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow: hidden;
        }

        .modal-header {
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-title {
            font-weight: bold;
            font-size: 1.2rem;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.2rem;
            color: var(--text-primary);
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: background 0.2s ease;
        }

        .modal-close:hover {
            background: var(--hover-color);
        }

        /* Loading */
        .loading {
            display: flex;
            justify-content: center;
            padding: 20px;
            color: var(--text-secondary);
        }

        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            border-radius: 4px;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* Responsive */
        @media (min-width: 768px) {
            .bottom-nav {
                display: none;
            }
            
            body {
                padding-bottom: 0;
            }
        }

        /* Dark mode improvements */
        [data-theme="dark"] .skeleton {
            background: linear-gradient(90deg, #2a2a2a 25%, #3a3a3a 50%, #2a2a2a 75%);
        }

        /* Utility classes */
        .hidden {
            display: none !important;
        }

        .text-center {
            text-align: center;
        }

        .mt-2 { margin-top: 8px; }
        .mb-2 { margin-bottom: 8px; }
        .p-3 { padding: 12px; }
        .btn {
            padding: 12px 24px;
            border-radius: 20px;
            border: none;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            width: 100%;
        }
        .btn-primary {
            background: var(--twitter-blue);
            color: white;
        }
        .btn-primary:hover {
            background: var(--twitter-blue-hover);
        }
    </style>
</head>
<body>
    <!-- Auth Modal -->
    <div class="modal active" id="authModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Join My Crush</div>
                <button class="modal-close" id="closeAuthModal">&times;</button>
            </div>
            <div class="auth-page">
                <div class="auth-form">
                    <div id="loginForm">
                        <h2>Sign in to Myc crush</h2>
                        <div class="form-group">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-input" id="loginEmail" placeholder="Enter your email">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Password</label>
                            <input type="password" class="form-input" id="loginPassword" placeholder="Enter your password">
                        </div>
                        <button class="btn btn-primary" id="loginBtn">Sign In</button>
                        <div class="auth-toggle">
                            Don't have an account? <a class="auth-link" id="showSignup">Sign up</a>
                        </div>
                    </div>

                    <div id="signupForm" class="hidden">
                        <h2>Create your account</h2>
                        <div class="form-group">
                            <label class="form-label">Full Name</label>
                            <input type="text" class="form-input" id="signupName" placeholder="Enter your full name">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Username</label>
                            <input type="text" class="form-input" id="signupUsername" placeholder="Choose a username">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-input" id="signupEmail" placeholder="Enter your email">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Password</label>
                            <input type="password" class="form-input" id="signupPassword" placeholder="Create a password">
                        </div>
                        <button class="btn btn-primary" id="signupBtn">Create Account</button>
                        <div class="auth-toggle">
                            Already have an account? <a class="auth-link" id="showLogin">Sign in</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main App (hidden until authenticated) -->
    <div id="appContainer" class="hidden">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <i class="fab fa-twitter"></i>
            </div>
            <div class="header-actions">
                <span id="userName" style="margin-right: 15px;"></span>
                <button id="themeToggle" class="action-btn">
                    <i class="fas fa-moon"></i>
                </button>
                <button id="logoutBtn" class="action-btn">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="container">
            <!-- Home Page -->
            <section id="homePage" class="page active">
                <!-- Tweet Composer -->
                <div class="tweet-composer">
                    <div class="composer-header">
                        <img src="" alt="Profile" class="avatar" id="userAvatar">
                        <textarea class="composer-textarea" placeholder="What's happening?" 
                                 id="tweetTextarea" maxlength="280"></textarea>
                    </div>
                    <div class="composer-actions">
                        <div class="action-buttons">
                            <button class="action-btn" id="mediaBtn">
                                <i class="fas fa-image"></i>
                            </button>
                            <button class="action-btn" id="gifBtn">
                                <i class="fas fa-film"></i>
                            </button>
                            <button class="action-btn" id="emojiBtn">
                                <i class="fas fa-smile"></i>
                            </button>
                        </div>
                        <div style="display: flex; align-items: center;">
                            <span class="char-count" id="charCount">280</span>
                            <button class="tweet-btn" id="tweetBtn" disabled>Tweet</button>
                        </div>
                    </div>
                </div>

                <!-- Feed -->
                <div id="feedContainer">
                    <div class="loading">
                        <i class="fas fa-spinner fa-spin"></i> Loading tweets...
                    </div>
                </div>
            </section>

            <!-- Search Page -->
            <section id="searchPage" class="page">
                <div class="p-3">
                    <div class="composer-header">
                        <div style="position: relative; width: 100%;">
                            <i class="fas fa-search" style="position: absolute; left: 16px; top: 50%; transform: translateY(-50%); color: var(--text-secondary);"></i>
                            <input type="text" class="composer-textarea" placeholder="Search Twitter" 
                                  style="padding-left: 40px; border-radius: 20px; background: var(--bg-secondary); border: 1px solid var(--border-color);">
                        </div>
                    </div>
                    
                    <div class="mt-2">
                        <h3>Trends for you</h3>
                        <div id="trendsContainer">
                            <!-- Trends will be loaded here -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- Notifications Page -->
            <section id="notificationsPage" class="page">
                <div class="p-3 text-center">
                    <h3>Notifications</h3>
                    <p class="mt-2">No notifications yet</p>
                </div>
            </section>

            <!-- Messages Page -->
            <section id="messagesPage" class="page">
                <div class="p-3 text-center">
                    <h3>Messages</h3>
                    <p class="mt-2">Your messages will appear here</p>
                </div>
            </section>

            <!-- Profile Page -->
            <section id="profilePage" class="page">
                <div class="p-3 text-center">
                    <img src="" alt="Profile" class="avatar" style="width: 80px; height: 80px;" id="profileAvatar">
                    <h3 class="mt-2" id="profileName">User Name</h3>
                    <p class="user-handle" id="profileHandle">@username</p>
                    
                    <div style="display: flex; justify-content: center; gap: 20px; margin: 16px 0;">
                        <div>
                            <strong id="tweetsCount">0</strong>
                            <div>Tweets</div>
                        </div>
                        <div>
                            <strong id="followingCount">0</strong>
                            <div>Following</div>
                        </div>
                        <div>
                            <strong id="followersCount">0</strong>
                            <div>Followers</div>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <a class="nav-item active" data-page="homePage">
                <div class="nav-icon"><i class="fas fa-home"></i></div>
                <span>Home</span>
            </a>
            <a class="nav-item" data-page="searchPage">
                <div class="nav-icon"><i class="fas fa-search"></i></div>
                <span>Search</span>
            </a>
            <a class="nav-item" data-page="notificationsPage">
                <div class="nav-icon"><i class="fas fa-bell"></i></div>
                <span>Notifications</span>
            </a>
            <a class="nav-item" data-page="messagesPage">
                <div class="nav-icon"><i class="fas fa-envelope"></i></div>
                <span>Messages</span>
            </a>
            <a class="nav-item" data-page="profilePage">
                <div class="nav-icon"><i class="fas fa-user"></i></div>
                <span>Profile</span>
            </a>
        </nav>
    </div>

    <script>

class TwitterClone {
    constructor() {
        this.tweets = [];
        this.users = [];
        this.currentUser = null;
        this.maxChars = 280;
        
        // Appwrite Configuration
        this.appwrite = {
            endpoint: 'https://nyc.cloud.appwrite.io/v1',
            projectId: '68d703340006625f81ab', // Replace with your Appwrite project ID
            databaseId: '68d703b100171300608e',
            collections: {
                users: 'users',
                tweets: 'tweets',
                likes: 'likes',
                follows: 'follows'
            }
        };
        
        this.init();
    }

    async init() {
        try {
            await this.initializeAppwrite();
            await this.checkAuthStatus();
            this.setupEventListeners();
            this.updateUI();
        } catch (error) {
            console.error('Initialization error:', error);
            this.showError('Failed to initialize app');
        }
    }

    async initializeAppwrite() {
        // Initialize Appwrite client
        this.client = new Appwrite.Client();
        this.client
            .setEndpoint(this.appwrite.endpoint)
            .setProject(this.appwrite.projectId);

        // Initialize Appwrite services
        this.account = new Appwrite.Account(this.client);
        this.databases = new Appwrite.Databases(this.client);
        this.realtime = new Appwrite.Realtime(this.client);

        console.log('Appwrite initialized');
    }

    async checkAuthStatus() {
        try {
            const user = await this.account.get();
            this.currentUser = user;
            this.showApp();
            await this.loadUserProfile();
            await this.loadFeed();
        } catch (error) {
            this.showAuthModal();
        }
    }

    async login(email, password) {
        try {
            const session = await this.account.createEmailPasswordSession(email, password);
            const user = await this.account.get();
            this.currentUser = user;
            this.showApp();
            await this.loadUserProfile();
            await this.loadFeed();
            this.showToast('Successfully signed in!');
            return true;
        } catch (error) {
            this.showError('Login failed: ' + error.message);
            return false;
        }
    }

    async signup(name, username, email, password) {
        try {
            // Create user account
            const user = await this.account.create('unique()', email, password, name);
            
            // Create user profile in database
            await this.databases.createDocument(
                this.appwrite.databaseId,
                this.appwrite.collections.users,
                'unique()',
                {
                    userId: user.$id,
                    name: name,
                    username: username.toLowerCase(),
                    email: email,
                    avatar: this.generateDefaultAvatar(name),
                    bio: '',
                    location: '',
                    website: '',
                    joinDate: new Date().toISOString(),
                    followersCount: 0,
                    followingCount: 0,
                    tweetsCount: 0
                }
            );

            // Create session
            await this.account.createEmailPasswordSession(email, password);
            this.currentUser = user;
            this.showApp();
            await this.loadUserProfile();
            this.showToast('Account created successfully!');
            return true;
        } catch (error) {
            this.showError('Signup failed: ' + error.message);
            return false;
        }
    }

    async logout() {
        try {
            await this.account.deleteSession('current');
            this.currentUser = null;
            this.tweets = [];
            this.showAuthModal();
            this.showToast('Successfully signed out');
        } catch (error) {
            this.showError('Logout failed: ' + error.message);
        }
    }

    async loadUserProfile() {
        if (!this.currentUser) return;

        try {
            const response = await this.databases.listDocuments(
                this.appwrite.databaseId,
                this.appwrite.collections.users,
                [`userId=${this.currentUser.$id}`]
            );

            if (response.documents.length > 0) {
                this.userProfile = response.documents[0];
                this.updateProfileUI();
            }
        } catch (error) {
            console.error('Error loading user profile:', error);
        }
    }

    async loadFeed() {
        if (!this.currentUser) return;

        try {
            const feedContainer = document.getElementById('feedContainer');
            feedContainer.innerHTML = '<div class="loading"><i class="fas fa-spinner fa-spin"></i> Loading tweets...</div>';

            // Get tweets from users you follow + your own tweets
            const response = await this.databases.listDocuments(
                this.appwrite.databaseId,
                this.appwrite.collections.tweets,
                [
                    'orderDesc("createdAt")',
                    'limit(50)'
                ]
            );

            this.tweets = response.documents;
            this.renderTweets(this.tweets);
            
            // Set up real-time updates
            this.setupRealtimeUpdates();

        } catch (error) {
            console.error('Error loading feed:', error);
            this.showError('Failed to load feed');
        }
    }

    async postTweet(content) {
        if (!this.currentUser || !content.trim()) return;

        try {
            const tweet = {
                content: content,
                authorId: this.currentUser.$id,
                authorName: this.userProfile?.name || this.currentUser.name,
                authorUsername: this.userProfile?.username || 'user',
                authorAvatar: this.userProfile?.avatar || this.generateDefaultAvatar(this.currentUser.name),
                likes: 0,
                retweets: 0,
                replies: 0,
                isLiked: false,
                isRetweeted: false,
                media: null,
                createdAt: new Date().toISOString()
            };

            const response = await this.databases.createDocument(
                this.appwrite.databaseId,
                this.appwrite.collections.tweets,
                'unique()',
                tweet
            );

            // Add to local tweets array
            this.tweets.unshift(response);
            this.renderTweets([response], true);
            this.clearComposer();
            this.showToast('Tweet posted successfully!');

            // Update user's tweet count
            await this.updateUserTweetCount();

        } catch (error) {
            console.error('Error posting tweet:', error);
            this.showError('Failed to post tweet');
        }
    }

    async likeTweet(tweetId) {
        if (!this.currentUser) return;

        try {
            const tweet = this.tweets.find(t => t.$id === tweetId);
            if (!tweet) return;

            // Check if already liked
            const existingLike = await this.databases.listDocuments(
                this.appwrite.databaseId,
                this.appwrite.collections.likes,
                [`userId=${this.currentUser.$id}`, `tweetId=${tweetId}`]
            );

            if (existingLike.documents.length > 0) {
                // Unlike
                await this.databases.deleteDocument(
                    this.appwrite.databaseId,
                    this.appwrite.collections.likes,
                    existingLike.documents[0].$id
                );
                tweet.likes = parseInt(tweet.likes) - 1;
                tweet.isLiked = false;
            } else {
                // Like
                await this.databases.createDocument(
                    this.appwrite.databaseId,
                    this.appwrite.collections.likes,
                    'unique()',
                    {
                        userId: this.currentUser.$id,
                        tweetId: tweetId,
                        createdAt: new Date().toISOString()
                    }
                );
                tweet.likes = parseInt(tweet.likes) + 1;
                tweet.isLiked = true;
            }

            // Update tweet in database
            await this.databases.updateDocument(
                this.appwrite.databaseId,
                this.appwrite.collections.tweets,
                tweetId,
                { likes: tweet.likes }
            );

            this.updateTweetUI(tweetId);

        } catch (error) {
            console.error('Error liking tweet:', error);
        }
    }

    setupRealtimeUpdates() {
        // Subscribe to new tweets
        this.realtime.subscribe(`databases.${this.appwrite.databaseId}.collections.${this.appwrite.collections.tweets}.documents`, (response) => {
            if (response.event === 'database.documents.create') {
                const newTweet = response.payload;
                if (newTweet.authorId !== this.currentUser.$id) {
                    this.tweets.unshift(newTweet);
                    this.renderTweets([newTweet], true);
                }
            }
        });

        // Subscribe to tweet updates (likes)
        this.realtime.subscribe(`databases.${this.appwrite.databaseId}.collections.${this.appwrite.collections.tweets}.documents`, (response) => {
            if (response.event === 'database.documents.update') {
                const updatedTweet = response.payload;
                const existingIndex = this.tweets.findIndex(t => t.$id === updatedTweet.$id);
                if (existingIndex !== -1) {
                    this.tweets[existingIndex] = updatedTweet;
                    this.updateTweetUI(updatedTweet.$id);
                }
            }
        });
    }

    setupEventListeners() {
        // Auth events
        document.getElementById('loginBtn').addEventListener('click', () => this.handleLogin());
        document.getElementById('signupBtn').addEventListener('click', () => this.handleSignup());
        document.getElementById('showSignup').addEventListener('click', () => this.showSignupForm());
        document.getElementById('showLogin').addEventListener('click', () => this.showLoginForm());
        document.getElementById('closeAuthModal').addEventListener('click', () => this.showAuthModal());
        document.getElementById('logoutBtn').addEventListener('click', () => this.logout());

        // Tweet composer
        const tweetTextarea = document.getElementById('tweetTextarea');
        const tweetBtn = document.getElementById('tweetBtn');

        tweetTextarea.addEventListener('input', (e) => {
            this.updateCharCount(e.target.value.length);
        });

        tweetBtn.addEventListener('click', () => {
            this.postTweet(tweetTextarea.value);
        });

        // Theme toggle
        document.getElementById('themeToggle').addEventListener('click', () => {
            this.toggleTheme();
        });

        // Navigation
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                this.showPage(item.dataset.page);
                
                document.querySelectorAll('.nav-item').forEach(nav => {
                    nav.classList.remove('active');
                });
                item.classList.add('active');
            });
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 'Enter' && tweetTextarea.value.trim()) {
                this.postTweet(tweetTextarea.value);
            }
        });
    }

    async handleLogin() {
        const email = document.getElementById('loginEmail').value;
        const password = document.getElementById('loginPassword').value;
        
        if (!email || !password) {
            this.showError('Please fill in all fields');
            return;
        }

        await this.login(email, password);
    }

    async handleSignup() {
        const name = document.getElementById('signupName').value;
        const username = document.getElementById('signupUsername').value;
        const email = document.getElementById('signupEmail').value;
        const password = document.getElementById('signupPassword').value;
        
        if (!name || !username || !email || !password) {
            this.showError('Please fill in all fields');
            return;
        }

        if (username.length < 3) {
            this.showError('Username must be at least 3 characters');
            return;
        }

        if (password.length < 6) {
            this.showError('Password must be at least 6 characters');
            return;
        }

        await this.signup(name, username, email, password);
    }

    showAuthModal() {
        document.getElementById('authModal').classList.add('active');
        document.getElementById('appContainer').classList.add('hidden');
        this.showLoginForm();
    }

    showApp() {
        document.getElementById('authModal').classList.remove('active');
        document.getElementById('appContainer').classList.remove('hidden');
    }

    showLoginForm() {
        document.getElementById('loginForm').classList.remove('hidden');
        document.getElementById('signupForm').classList.add('hidden');
    }

    showSignupForm() {
        document.getElementById('loginForm').classList.add('hidden');
        document.getElementById('signupForm').classList.remove('hidden');
    }

    showPage(pageId) {
        document.querySelectorAll('.page').forEach(page => {
            page.classList.remove('active');
        });
        document.getElementById(pageId).classList.add('active');
        
        switch(pageId) {
            case 'homePage':
                this.loadFeed();
                break;
            case 'profilePage':
                this.loadProfile();
                break;
        }
    }

    updateCharCount(length) {
        const charCount = document.getElementById('charCount');
        const tweetBtn = document.getElementById('tweetBtn');
        
        charCount.textContent = this.maxChars - length;
        
        charCount.classList.remove('warning', 'error');
        if (length > 260) charCount.classList.add('warning');
        if (length > this.maxChars) charCount.classList.add('error');
        
        tweetBtn.disabled = length === 0 || length > this.maxChars;
    }

    clearComposer() {
        const textarea = document.getElementById('tweetTextarea');
        textarea.value = '';
        this.updateCharCount(0);
    }

    renderTweets(tweets, prepend = false) {
        const feedContainer = document.getElementById('feedContainer');
        
        if (tweets.length === 0) {
            feedContainer.innerHTML = '<div class="p-3 text-center">No tweets yet. Be the first to tweet!</div>';
            return;
        }

        const tweetsHTML = this.generateTweetHTML(tweets);
        
        if (prepend) {
            feedContainer.innerHTML = tweetsHTML + feedContainer.innerHTML;
        } else {
            feedContainer.innerHTML = tweetsHTML;
        }
        
        this.attachTweetEventListeners();
    }

    generateTweetHTML(tweets) {
        return tweets.map(tweet => `
            <div class="tweet" data-tweet-id="${tweet.$id}">
                <div style="display: flex; gap: 12px;">
                    <img src="${tweet.authorAvatar}" alt="${tweet.authorName}" class="avatar">
                    <div style="flex: 1;">
                        <div class="tweet-header">
                            <span class="user-name">${tweet.authorName}</span>
                            <span class="user-handle">@${tweet.authorUsername}</span>
                            <span>·</span>
                            <span class="tweet-time">${this.formatTime(tweet.createdAt)}</span>
                        </div>
                        <div class="tweet-content">${this.formatTweetContent(tweet.content)}</div>
                        <div class="tweet-actions">
                            <button class="tweet-action comment-action" data-action="comment">
                                <i class="far fa-comment"></i>
                                <span>${tweet.replies || 0}</span>
                            </button>
                            <button class="tweet-action retweet-action ${tweet.isRetweeted ? 'retweeted' : ''}" data-action="retweet">
                                <i class="fas fa-retweet"></i>
                                <span>${tweet.retweets || 0}</span>
                            </button>
                            <button class="tweet-action like-action ${tweet.isLiked ? 'liked' : ''}" data-action="like">
                                <i class="${tweet.isLiked ? 'fas' : 'far'} fa-heart"></i>
                                <span>${tweet.likes || 0}</span>
                            </button>
                            <button class="tweet-action" data-action="share">
                                <i class="far fa-share-square"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        `).join('');
    }

    attachTweetEventListeners() {
        document.querySelectorAll('.like-action').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.stopPropagation();
                const tweetId = btn.closest('.tweet').dataset.tweetId;
                this.likeTweet(tweetId);
            });
        });
    }

    updateTweetUI(tweetId) {
        const tweetElement = document.querySelector(`[data-tweet-id="${tweetId}"]`);
        if (!tweetElement) return;

        const tweet = this.tweets.find(t => t.$id === tweetId);
        if (!tweet) return;

        const likeBtn = tweetElement.querySelector('.like-action');
        const likeCount = likeBtn.querySelector('span');
        const likeIcon = likeBtn.querySelector('i');

        likeBtn.classList.toggle('liked', tweet.isLiked);
        likeIcon.className = tweet.isLiked ? 'fas fa-heart' : 'far fa-heart';
        likeCount.textContent = tweet.likes || 0;
    }

    updateProfileUI() {
        if (!this.userProfile) return;

        document.getElementById('userName').textContent = this.userProfile.name;
        document.getElementById('userAvatar').src = this.userProfile.avatar;
        document.getElementById('profileName').textContent = this.userProfile.name;
        document.getElementById('profileHandle').textContent = '@' + this.userProfile.username;
        document.getElementById('profileAvatar').src = this.userProfile.avatar;
        document.getElementById('tweetsCount').textContent = this.userProfile.tweetsCount || 0;
        document.getElementById('followingCount').textContent = this.userProfile.followingCount || 0;
        document.getElementById('followersCount').textContent = this.userProfile.followersCount || 0;
    }

    async updateUserTweetCount() {
        if (!this.userProfile) return;

        try {
            const newCount = (this.userProfile.tweetsCount || 0) + 1;
            await this.databases.updateDocument(
                this.appwrite.databaseId,
                this.appwrite.collections.users,
                this.userProfile.$id,
                { tweetsCount: newCount }
            );
            this.userProfile.tweetsCount = newCount;
            this.updateProfileUI();
        } catch (error) {
            console.error('Error updating tweet count:', error);
        }
    }

    generateDefaultAvatar(name) {
        // Generate a simple avatar based on name initials
        const initials = name.split(' ').map(n => n[0]).join('').toUpperCase();
        const colors = ['#1da1f2', '#17bf63', '#f91880', '#794bc4', '#ffad1f'];
        const color = colors[initials.charCodeAt(0) % colors.length];
        
        return `https://ui-avatars.com/api/?name=${encodeURIComponent(initials)}&background=${color.replace('#', '')}&color=fff&size=128`;
    }

    formatTweetContent(content) {
        return content
            .replace(/(https?:\/\/[^\s]+)/g, '<a href="$1" style="color: var(--twitter-blue);">$1</a>')
            .replace(/#(\w+)/g, '<span style="color: var(--twitter-blue);">#$1</span>')
            .replace(/@(\w+)/g, '<span style="color: var(--twitter-blue);">@$1</span>');
    }

    formatTime(timestamp) {
        const now = new Date();
        const tweetTime = new Date(timestamp);
        const diffMs = now - tweetTime;
        const diffMins = Math.floor(diffMs / (1000 * 60));
        const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
        const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
        
        if (diffMins < 1) return 'now';
        if (diffMins < 60) return `${diffMins}m`;
        if (diffHours < 24) return `${diffHours}h`;
        if (diffDays < 7) return `${diffDays}d`;
        
        return tweetTime.toLocaleDateString();
    }

    toggleTheme() {
        const currentTheme = document.documentElement.getAttribute('data-theme');
        const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
        
        document.documentElement.setAttribute('data-theme', newTheme);
        localStorage.setItem('theme', newTheme);
        
        const themeIcon = document.querySelector('#themeToggle i');
        themeIcon.className = newTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
    }

    showToast(message, type = 'success') {
        const toast = document.createElement('div');
        toast.style.cssText = `
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--twitter-blue);
            color: white;
            padding: 12px 24px;
            border-radius: 20px;
            z-index: 10000;
            animation: slideUp 0.3s ease;
        `;
        
        toast.textContent = message;
        document.body.appendChild(toast);
        
        setTimeout(() => {
            toast.style.animation = 'slideDown 0.3s ease';
            setTimeout(() => toast.remove(), 300);
        }, 3000);
    }

    showError(message) {
        this.showToast(message, 'error');
    }

    updateUI() {
        const savedTheme = localStorage.getItem('theme') || 'light';
        document.documentElement.setAttribute('data-theme', savedTheme);
        
        const themeIcon = document.querySelector('#themeToggle i');
        themeIcon.className = savedTheme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
    }
}

// Add CSS animations
const style = document.createElement('style');
style.textContent = `
    @keyframes slideUp {
        from {
            opacity: 0;
            transform: translateX(-50%) translateY(20px);
        }
        to {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }
    }
    
    @keyframes slideDown {
        from {
            opacity: 1;
            transform: translateX(-50%) translateY(0);
        }
        to {
            opacity: 0;
            transform: translateX(-50%) translateY(20px);
        }
    }
`;
document.head.appendChild(style);

// Initialize the app when DOM is loaded
document.addEventListener('DOMContentLoaded', () => {
    window.twitterApp = new TwitterClone();
});
</script>
</body>
</html>